<!DOCTYPE html>

<html>

  <head>
    <meta charset="UTF-8">

    <link href='hero.css' rel='stylesheet' type='text/css'>

  </head>

  <body scroll="no">

    <p>Control the scientist using the arrow keys. Avoid fireballs.</p>

    <div id = "display" style="width: 1024px; height: 768px; position: relative; overflow: hidden;">
      <h1>Loading...</h1>
      </div>
    </div>

    <div id = 'controller'>

      <div class = "up" id="up" style="display: block;">&#9650;</div>

      <div class = "left" id="left" style="display: inline-block; margin-right: 30px">&#9664;</div>

      <div class = "right" id="right" style="display: inline-block;">&#9654;</div>

      <div class = "down" id="down" style="display: block;">&#9660;</div>
    </div>


    <script>

      var upButton = document.getElementById("controller").getElementsByClassName("up")[0];
      var leftButton = document.getElementById("controller").getElementsByClassName("left")[0];
      var rightButton = document.getElementById("controller").getElementsByClassName("right")[0];
      var downButton = document.getElementById("controller").getElementsByClassName("down")[0];

      upButton.addEventListener("touchstart", function(e) {
        e.preventDefault();
        keyHandler.register(UP_PRESS);
      });
      upButton.addEventListener("touchend", function(e) {
        e.preventDefault();
        keyHandler.register(UP_RELEASE);
      });

      leftButton.addEventListener("touchstart", function(e) {
        e.preventDefault();
        keyHandler.register(LEFT_PRESS);
      });
      leftButton.addEventListener("touchend", function(e) {
        e.preventDefault();
        keyHandler.register(LEFT_RELEASE);
      });

      rightButton.addEventListener("touchstart", function(e) {
        e.preventDefault();
        keyHandler.register(RIGHT_PRESS);
      });
      rightButton.addEventListener("touchend", function(e) {
        e.preventDefault();
        keyHandler.register(RIGHT_RELEASE);
      });

      downButton.addEventListener("touchstart", function(e) {
        e.preventDefault();
        keyHandler.register(DOWN_PRESS);
      });
      downButton.addEventListener("touchend", function(e) {
        e.preventDefault();
        keyHandler.register(DOWN_RELEASE);
      });
    </script>


    <script src = "libraries/vector.js"></script>
    <script src = "libraries/vendor/bezierjs-gh-pages/bezier.js"></script>

    <script src = "globals.js"></script>
    <script src = "systems/collision/collision-component.js"></script>
    <script src = "systems/collision/collision-engine.js"></script>
    <script src = "systems/impulse/impulse-component.js"></script>
    <script src = "systems/move/move-component.js"></script>
    <script src = "systems/movement/movement-component.js"></script>
    <script src = "systems/resistence/resistence-component.js"></script>
    <script src = "systems/sprite/sprite-component.js"></script>
    <script src = "systems/sprite/sprite-engine.js"></script>
    <script src = "systems/travel-map/travel-map-component.js"></script>
    <script src = "systems/terrain/terrain.js"></script>
    <script src = "systems/viewport/viewport.js"></script>
    <script src = "systems/viewport/viewport.js"></script>

    <script src = "classes/game-entity.js"></script>
    <script src = "classes/actor.js"></script>
    <script src = "classes/player.js"></script>
    <script src = "classes/fireball.js"></script>
    <script src = "weapons.js"></script>
    <script src = "states.js"></script>

    <script src = "initializer.js"></script>

    <script src = "view/keyhandlers.js"></script>


    <script>

      var scene = new Scene({
        htmlElement: document.getElementById("display")
      });

      var backbglayer = new ImageLayer({
        scene: scene,
        content: images.backgroundback,
        parallaxScale: .2
      });

      var frontbglayer = new ImageLayer({
        scene: scene,
        content: images.backgroundfront
      });

      // var testpath = new ImageLayer({
      //   scene: scene,
      //   content: images.bgmask
      // });

      var spriteLayer = new SpriteLayer({
        scene: scene
      });

      var initialTerrain = new Terrain({
        map: walkmask,
        values: {}
      });

      var spriteEngine = new SpriteEngine({
        output: spriteLayer.content
      });

      var collisionEngine = new CollisionEngine();

      var hero = new Player(),
          twin = new Actor(),
          fireball = new Fireball(),
          fireball2 = new Fireball();

      scene.follow(hero);

      var entities = [hero,twin,fireball,fireball2,scene,spriteEngine];

      hero.x = 320;
      hero.y = 470;

      twin.name = "twin";
      twin.x = 1200;
      twin.y = 530;

      fireball2.x = -200;
      fireball2.y = 0;
      fireball2.originalX = 2200;
      fireball2.originalY = 0
      fireball2.acceleration = [-30,2];
      fireball2.originalAcceleration = [-30,2];
      fireball2.zIndex = 1350;

      //* BEGIN GAME LOOP ====================
      function beginGameLoop(){
        var gameLoop = window.requestAnimationFrame(tick);
      }

      function tick(timestamp){
        window.requestAnimationFrame(tick);
        for (var i = 0; i < entities.length; i++){
          if (entities[i]){
            entities[i].update(timestamp);
          }
        };
      };

    </script>



  </body>

</html>