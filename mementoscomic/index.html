<!DOCTYPE html>

<html>

  <head>

    <title>Mementos: A Star Wars Fancomic by Clairemation</title>

    <style>
    .slidecontainer {
      width: 100%;
    }

    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 10px;
      background: #fff;
      outline: none;
      border-radius: 15%;
      /*opacity: 0.7;*/
      /*-webkit-transition: .2s;
      transition: opacity .2s;*/
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 35px;
      height: 35px;
      border: 5px solid #444;
      border-radius: 50%;
      background: #999;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      background: #4CAF50;
    }
    </style>

  </head>

  <body style = "text-align: center; background-color: #000; color: #fff; font-face: sans-serif;">

    <div id="pageHolder" style="position: absolute; left: 0; top: 0; width: 100%; height: 100%; display: flex; flex-direction: column; ">

      <!-- <div id = "menu"style = "width: 50px; text-align: center; background-color: #000; color: #fff; font-face: sans-serif;">&#9776;</div> -->

  		<div id = "page-holder" style = "position: relative; display: flex; flex-direction: row; align-content: center; align-items: center; justify-content: center; text-align: center; height: 100%; flex-shrink: 1;">

        <div id="nav-links" style="position: absolute; width: 100%; height: 100%;">
          <a id="prev-link"><div style="position: absolute; left: 0; top: 0; width: 50%; height: 100%;"> </div></a>
          <a id="next-link"><div style="position: absolute: right: 0; top: 0; width: 50%; height: 100%;"> </div></a>
        </div>

  		</div>

    		<div id="slidecontainer" style = "display:flex; flex-direction: row; align-items: center; justify-content: center; text-align: center; width: 100%; height: 100px;">
    		  <span id ="slider-output" style = "width: 10%; font-size: 1.25em; font-face: sans-serif;">1</span>
  		    <input id="slider" type="range" min="1" max="40" value="1" class="slider" style= "-webkit-appearance: none; appearance: none; background: #fff; width: 80%;">
      		<div id = "displaybutton-holder" style = "display:flex; flex-direction: row; align-items: center; justify-content: center; text-align: center; height: 50px; width: 10%;">
      			<a id="display-button-anchor"><button id="display-button"></button></a>
      		</div>
    		</div>

    </div>


  	<script>

      const PageHolder = document.getElementById("page-holder")

  		const PageMin = 1, PageMax = 40
  		const PageRatio = 1350 / 1800
  		const SpreadRatio = 1350 * 2 / 1800
  		const WindowRatio = PageHolder.clientWidth / PageHolder.clientHeight

  		const shouldBaseSingleOnHeight = WindowRatio >= PageRatio
  		const shouldBaseSpreadOnHeight = WindowRatio >= SpreadRatio

  		const Params = new URLSearchParams(window.location.search)

  		const BasePageNum = parseInt(Params.get("page")) || 1

  		const BUTTON_HEIGHT = 100

  		var IsSpread

  		if (Params.has("spread"))
  		{
   			IsSpread = Params.get("spread") == "true" || false
  		}
  		else {
  			IsSpread = shouldBaseSpreadOnHeight
  		}

      var shouldBaseOnHeight =
        (IsSpread && shouldBaseSpreadOnHeight) || (!IsSpread && shouldBaseSingleOnHeight)

  		document.getElementById("display-button-anchor").href = "?page=" + BasePageNum + "&spread=" + (!IsSpread).toString()
  		document.getElementById("display-button").innerHTML = IsSpread ? "Display: single page" : "Display: spread"

  		var slider = document.getElementById("slider")
  		var sliderOutput = document.getElementById("slider-output")
  		var goPageButton = document.getElementById("go-page-button")

  		var pageHeight, pageWidth, pageStart, pageEnd

  		if (IsSpread)
  		{
  			if (shouldBaseSpreadOnHeight)
  			{
  				pageHeight = PageHolder.clientHeight
  				pageWidth = pageHeight * PageRatio
  			}
  			else {
  				pageWidth = PageHolder.clientWidth / 2
  				pageHeight = pageWidth / PageRatio
  			}
  			if (BasePageNum % 2 == 0)
  			{
  				pageStart = BasePageNum
  				pageEnd = BasePageNum + 1
  			}
  			else {
  				pageStart = BasePageNum - 1
  				pageEnd = BasePageNum
  			}
  		}
  		else {
  			if (shouldBaseSingleOnHeight)
  			{
	  				pageHeight = PageHolder.clientHeight
	  				pageWidth = pageHeight * PageRatio
  			} else {
  				pageWidth = window.innerWidth
  				pageHeight = pageWidth / PageRatio
  			}
	  			pageStart = pageEnd = BasePageNum
  		}


  		var pageHolder = document.getElementById("page-holder")

  		for (var i = pageStart; i <= pageEnd; i++)
  		{
  			pageHolder.appendChild(createPage(i, pageWidth, pageHeight))
  		}
  	


  		if (IsSpread)
  		{
  			slider.min = 0
  			slider.max = PageMax / 2
  			slider.value = pageStart / 2
  			if (slider.value == 0)
  			{
  				sliderOutput.innerHTML = getPageDisplayNum(pageEnd)
  			} else {
	  			sliderOutput.innerHTML = getPageDisplayNum(pageStart) + "-" + getPageDisplayNum(pageEnd)
	  		}
  		}
  		else {
  			slider.min = 1
  			slider.max = PageMax
  			slider.value = BasePageNum
  			sliderOutput.innerHTML = getPageDisplayNum(BasePageNum)
  		}

  		function updateSliderValueSpread()
  		{
  			var value = slider.value * 2
  			if (value == 0){
  				sliderOutput.innerHTML = getPageDisplayNum(value + 1)
  			} else {
  			sliderOutput.innerHTML = getPageDisplayNum(value) + "-" + getPageDisplayNum(value + 1)
	  		}
  		}

  		function updateSliderValueSinglePage()
  		{
  			var value = slider.value
  			sliderOutput.innerHTML = getPageDisplayNum(value)
  		}

  		function getPageDisplayNum(num)
  		{
  			if (num <=4)
  			{
  				return (["", "i", "ii", "cover", "note"])[num]
  			}
  			else {
  				return (num - 4).toString()
  			}
  		}

  		slider.oninput = IsSpread ? updateSliderValueSpread : updateSliderValueSinglePage

  		slider.onmouseup = (() => {
  			var pageNum = IsSpread ? slider.value * 2 : slider.value
  			window.location.href = "?page=" + pageNum + "&spread=" + IsSpread
  		})


  		var increment = IsSpread ? 2 : 1

  		var prevUrl = "?page=" + Math.max((BasePageNum - increment), PageMin) + "&spread=" + IsSpread
  		var nextUrl = "?page=" + Math.min((BasePageNum + increment), PageMax) + "&spread=" + IsSpread

      document.getElementById("prev-link").href = prevUrl
      document.getElementById("next-link").href = nextUrl

  		function createPage(index, width, height)
  		{
	  		var div = document.createElement("div")
	  		div.style = "height: 100%; width: 100%;"

	  		if (index < PageMin || index > PageMax)
	  		{
	  			return div
	  		}

	  		if (index == 4)
	  		{
	  			div.innerHTML = "After the defeat of Emperor Palpatine and before Rey's trip to Tatooine..."
	  			return div
	  		}

  			var src = "jpg/" + index.toString().padStart(2, "0") + ".jpg"
	  		var img = document.createElement("img")
	  		img.src = src
        var width = IsSpread ? "50" : "100"
	  		img.style = shouldBaseOnHeight ? "height: 100%; width: auto;" : "width: " + width + "%; flex: 1; height: auto;"
	  		div.appendChild(img)
        return img
	  		return div
  		}

  	</script>

  </body>

</html>